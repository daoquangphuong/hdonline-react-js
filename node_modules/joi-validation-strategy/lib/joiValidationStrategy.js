'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _joi = require('joi');

var _joi2 = _interopRequireDefault(_joi);

var _lodashUnion = require('lodash.union');

var _lodashUnion2 = _interopRequireDefault(_lodashUnion);

exports['default'] = function (joiOptions) {
  return {
    validate: function validate(data, joiSchema, key) {
      if (data === undefined) data = {};
      if (joiSchema === undefined) joiSchema = {};

      var options = _extends({
        abortEarly: false,
        allowUnknown: true
      }, joiOptions);
      var errors = this._format(_joi2['default'].validate(data, joiSchema, options));
      if (key === undefined) {
        _lodashUnion2['default'](Object.keys(joiSchema), Object.keys(data)).forEach(function (error) {
          errors[error] = errors[error] || [];
        });
        return errors;
      }
      var result = {};
      result[key] = errors[key];
      return result;
    },
    _format: function _format(joiResult) {
      if (joiResult.error !== null) {
        return joiResult.error.details.reduce(function (memo, detail) {
          if (!Array.isArray(memo[detail.path])) {
            memo[detail.path] = [];
          }
          memo[detail.path].push(detail.message);
          return memo;
        }, {});
      }
      return {};
    }
  };
};

module.exports = exports['default'];